<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kick Chat Messages</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
    #messages { list-style: none; padding: 0; }
    #messages li { padding: 8px; border-bottom: 1px solid #ccc; }
    #messages li strong { color: #0077cc; }
  </style>
</head>
<body>
  <h1>Kick Chat Messages (public)</h1>
  <ul id="messages"></ul>

  <script>
    async function fetchMessages() {
      try {
        const res = await fetch("/messages");
        if (!res.ok) throw new Error("Failed to fetch messages");
        const data = await res.json();

        const messagesList = document.getElementById("messages");
        messagesList.innerHTML = "";

        // Kick's API response has a "messages" array
        if (data.messages && Array.isArray(data.messages)) {
          data.messages.forEach(msg => {
            const li = document.createElement("li");
            const time = new Date(msg.created_at).toLocaleTimeString();
            li.innerHTML = `<strong>${msg.user?.username || "Unknown"}</strong> [${time}]: ${msg.message || ""}`;
            messagesList.appendChild(li);
          });
        } else {
          messagesList.textContent = "No messages found or invalid response.";
        }
      } catch (e) {
        console.error(e);
        document.getElementById("messages").textContent = "Error loading messages.";
      }
    }

    setInterval(fetchMessages, 5000);
    fetchMessages();
  </script>
</body>
</html>

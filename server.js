const _0x263caa=_0x49ca;(function(_0x148aac,_0x26b460){const _0x51d7e0=_0x49ca,_0x11b845=_0x148aac();while(!![]){try{const _0x4797c9=parseInt(_0x51d7e0(0x1dc))/0x1*(-parseInt(_0x51d7e0(0x1b5))/0x2)+parseInt(_0x51d7e0(0x1dd))/0x3*(-parseInt(_0x51d7e0(0x1cd))/0x4)+-parseInt(_0x51d7e0(0x1f7))/0x5+-parseInt(_0x51d7e0(0x1da))/0x6*(-parseInt(_0x51d7e0(0x202))/0x7)+parseInt(_0x51d7e0(0x1e7))/0x8*(-parseInt(_0x51d7e0(0x1b3))/0x9)+parseInt(_0x51d7e0(0x1ec))/0xa+parseInt(_0x51d7e0(0x1cf))/0xb*(parseInt(_0x51d7e0(0x1de))/0xc);if(_0x4797c9===_0x26b460)break;else _0x11b845['push'](_0x11b845['shift']());}catch(_0x2fbfb5){_0x11b845['push'](_0x11b845['shift']());}}}(_0x5eea,0x4f465));function _0x49ca(_0x303891,_0x44ce0b){const _0x5eea02=_0x5eea();return _0x49ca=function(_0x49caa9,_0x1b83f7){_0x49caa9=_0x49caa9-0x1b0;let _0x190f75=_0x5eea02[_0x49caa9];return _0x190f75;},_0x49ca(_0x303891,_0x44ce0b);}import _0x49de20 from'express';import _0x5c058e from'mongoose';import _0x6d7f19 from'node-fetch';import _0x10ecfb from'node-cron';import _0x2ec84e from'crypto';const app=_0x49de20(),PORT=process['env']['PORT']||0xbb8,CHANNEL_ID='1485854';await _0x5c058e[_0x263caa(0x200)]('mongodb+srv://davekekv:C4kxK3SFZkLA2CZe@cluster0.wkodygj.mongodb.net/leaderboardDB?retryWrites=true&w=majority',{'useNewUrlParser':!![],'useUnifiedTopology':!![]});const messageSchema=new _0x5c058e[(_0x263caa(0x1e2))]({'username':{'type':String,'unique':!![]},'messageCount':{'type':Number,'default':0x0}}),Message=_0x5c058e[_0x263caa(0x1d1)](_0x263caa(0x1c3),messageSchema),rollSchema=new _0x5c058e[(_0x263caa(0x1e2))]({'winner':{'type':String,'required':!![]},'prize':{'type':Number,'required':!![]},'timestamp':{'type':Date,'default':Date[_0x263caa(0x1c8)]},'serverSeed':{'type':String,'required':!![]},'clientSeed':{'type':String,'required':!![]},'nonce':{'type':Number,'required':!![]},'hash':{'type':String,'required':!![]}}),Roll=_0x5c058e['model'](_0x263caa(0x1ed),rollSchema);let lastSeenMessageId=null;const userLastMessages=new Map(),IGNORED_USERS=[_0x263caa(0x1d4),_0x263caa(0x1ba)];let nextRollTime=null,rollInterval=null,serverSeed=generateServerSeed(),nonce=0x0;function generateServerSeed(){const _0x5ea527=_0x263caa;return Math['random']()['toString'](0x24)['substring'](0x2,0xf)+Math[_0x5ea527(0x1fd)]()['toString'](0x24)[_0x5ea527(0x1e9)](0x2,0xf);}async function sha256(_0x5a8f5b){const _0xe017c6=_0x263caa;return _0x2ec84e[_0xe017c6(0x209)](_0xe017c6(0x1ea))[_0xe017c6(0x1c7)](_0x5a8f5b)['digest'](_0xe017c6(0x1c2));}async function generateRoll(_0x5003b1,_0x4dec26,_0x290847){const _0x256778=_0x263caa,_0x5ebb3b=_0x5003b1+'-'+_0x4dec26+'-'+_0x290847,_0x38f0cd=await sha256(_0x5ebb3b);return parseInt(_0x38f0cd[_0x256778(0x1e9)](0x0,0x8),0x10)/Math[_0x256778(0x1e5)](0x2,0x20);}function getNextRollTime(){return getNextResetDate();}async function performRoll(){const _0x253cdb=_0x263caa;try{const _0x5bfbe9=await Message['find']()[_0x253cdb(0x1c9)]({'messageCount':-0x1})[_0x253cdb(0x1db)](0xa)[_0x253cdb(0x1fc)]();if(_0x5bfbe9[_0x253cdb(0x1b7)]===0x0){console[_0x253cdb(0x1f1)]('No\x20users\x20available\x20for\x20roll');return;}const _0x1c497a=Date[_0x253cdb(0x1c8)]()[_0x253cdb(0x1be)](),_0x49c944=await generateRoll(serverSeed,_0x1c497a,nonce),_0x5290a4=Math[_0x253cdb(0x1d0)](_0x49c944*_0x5bfbe9[_0x253cdb(0x1b7)]),_0x51e531=_0x5bfbe9[_0x5290a4],_0x30d2d1=new Roll({'winner':_0x51e531['username'],'prize':0xa,'serverSeed':serverSeed,'clientSeed':_0x1c497a,'nonce':nonce,'hash':await sha256(serverSeed+'-'+_0x1c497a+'-'+nonce)});await _0x30d2d1[_0x253cdb(0x1e0)](),console[_0x253cdb(0x1f1)]('Roll\x20completed!\x20Winner:\x20'+_0x51e531[_0x253cdb(0x1b8)]+_0x253cdb(0x1f2)),nonce++,nextRollTime=getNextRollTime();}catch(_0x450510){console[_0x253cdb(0x1d8)](_0x253cdb(0x1fe),_0x450510);}}function getNextResetDate(){const _0x5c9890=_0x263caa,_0x18ced7=new Date();let _0x35bef1=new Date(_0x18ced7['getFullYear'](),0x6,0x1,0x0,0x0,0x0,0x0);return _0x18ced7>_0x35bef1&&(_0x35bef1=new Date(_0x18ced7[_0x5c9890(0x1e4)]()+0x1,0x6,0x1,0x0,0x0,0x0,0x0)),_0x35bef1;}function getTimeUntilReset(){const _0x742c79=_0x263caa,_0x2da078=new Date(),_0x4bae20=getNextResetDate(),_0x183fd4=_0x4bae20[_0x742c79(0x1b4)]()-_0x2da078['getTime']();return Math[_0x742c79(0x1e1)](0x0,_0x183fd4);}async function resetLeaderboard(){const _0xe08d9d=_0x263caa;try{await Message[_0xe08d9d(0x1d3)]({}),await Roll['deleteMany']({}),lastSeenMessageId=null,userLastMessages[_0xe08d9d(0x20a)](),serverSeed=generateServerSeed(),nonce=0x0,nextRollTime=getNextRollTime(),console['log'](_0xe08d9d(0x1f3));}catch(_0x3d6825){console[_0xe08d9d(0x1d8)]('Error\x20resetting\x20leaderboard:',_0x3d6825);}}app[_0x263caa(0x203)](_0x263caa(0x1c5),(_0x4140b2,_0xd8ccc8)=>{const _0x130f11=_0x263caa,_0x4035d6=getTimeUntilReset(),_0x2ca522=Math['floor'](_0x4035d6/(0x3e8*0x3c*0x3c*0x18)),_0xd5f8d6=Math[_0x130f11(0x1d0)](_0x4035d6%(0x3e8*0x3c*0x3c*0x18)/(0x3e8*0x3c*0x3c)),_0x59a1a5=Math[_0x130f11(0x1d0)](_0x4035d6%(0x3e8*0x3c*0x3c)/(0x3e8*0x3c)),_0x38701f=Math[_0x130f11(0x1d0)](_0x4035d6%(0x3e8*0x3c)/0x3e8);_0xd8ccc8['json']({'timeLeft':_0x4035d6,'days':_0x2ca522,'hours':_0xd5f8d6,'minutes':_0x59a1a5,'seconds':_0x38701f,'nextReset':getNextResetDate()[_0x130f11(0x1f9)]()});}),app[_0x263caa(0x203)](_0x263caa(0x1ef),async(_0x3b8bf0,_0x487bd8)=>{const _0x18b942=_0x263caa;try{const _0x253254=getTimeUntilReset(),_0x1b5353=await Roll[_0x18b942(0x1cb)]()['sort']({'timestamp':-0x1});_0x487bd8[_0x18b942(0x1f4)]({'nextRollTime':getNextResetDate()[_0x18b942(0x1f9)](),'timeUntilRoll':Math[_0x18b942(0x1e1)](0x0,_0x253254),'latestRoll':_0x1b5353?{'winner':_0x1b5353[_0x18b942(0x1e3)],'prize':_0x1b5353['prize'],'timestamp':_0x1b5353[_0x18b942(0x1bd)],'hash':_0x1b5353[_0x18b942(0x204)]}:null});}catch(_0x15eed7){_0x487bd8[_0x18b942(0x1d6)](0x1f4)['json']({'error':_0x15eed7[_0x18b942(0x207)]});}}),app['get']('/roll-history',async(_0x471fe0,_0x33d33f)=>{const _0x5987f1=_0x263caa;try{const _0x914216=await Roll[_0x5987f1(0x1c6)]()[_0x5987f1(0x1c9)]({'timestamp':-0x1})[_0x5987f1(0x1db)](0xa);_0x33d33f[_0x5987f1(0x1f4)](_0x914216[_0x5987f1(0x1eb)](_0x513c84=>({'winner':_0x513c84[_0x5987f1(0x1e3)],'prize':_0x513c84[_0x5987f1(0x1bb)],'timestamp':_0x513c84['timestamp'],'hash':_0x513c84[_0x5987f1(0x204)]})));}catch(_0x4dbb0d){_0x33d33f['status'](0x1f4)[_0x5987f1(0x1f4)]({'error':_0x4dbb0d[_0x5987f1(0x207)]});}}),app[_0x263caa(0x203)](_0x263caa(0x1ff),(_0x2793f7,_0x39e703)=>{const _0x349f3b=_0x263caa;_0x39e703[_0x349f3b(0x1f4)]({'serverSeed':serverSeed,'nextRollTime':nextRollTime?nextRollTime[_0x349f3b(0x1f9)]():null});});function isSpamMessage(_0x19933b,_0x3026e3,_0x3d91c7){const _0x28ad6e=_0x263caa,_0x5c632d=_0x3026e3['trim']();if(!_0x5c632d)return!![];if(/^\[emote:\d+:[^\]]+\]$/['test'](_0x5c632d))return!![];if(_0x5c632d['length']<=0x2)return!![];const _0x3d02ed=_0x5c632d['replace'](/[^A-Za-z]/g,'');if(_0x3d02ed[_0x28ad6e(0x1b7)]>=0x6){const _0x3167f7=(_0x3d02ed[_0x28ad6e(0x1f0)](/[A-Z]/g)||[])['length'];if(_0x3167f7/_0x3d02ed[_0x28ad6e(0x1b7)]>0.8)return!![];}const _0x34b2e3=userLastMessages[_0x28ad6e(0x203)](_0x19933b);if(_0x34b2e3){if(_0x34b2e3[_0x28ad6e(0x206)]===_0x5c632d)return!![];if(similarity(_0x34b2e3[_0x28ad6e(0x206)],_0x5c632d)>0.9)return!![];if(_0x3d91c7-_0x34b2e3['timestamp']<0x3e8)return!![];}return userLastMessages['set'](_0x19933b,{'content':_0x5c632d,'timestamp':_0x3d91c7}),![];}function _0x5eea(){const _0x1b9854=['54672tJuDNh','/live-status','substring','sha256','map','5075090ZANYUp','Roll','livestream','/roll-info','match','log',',\x20Prize:\x20$10','Leaderboard\x20reset\x20-\x207\x20day\x20cycle\x20completed','json','has','size','1293125cmGXPl','Fetch\x20failed','toISOString','is_live','includes','lean','random','Error\x20performing\x20roll:','/current-seed','connect','text','417571hbRqnF','get','hash','*\x20*\x20*\x20*\x20*','content','message','split','createHash','clear','schedule','/leaderboard','/messages','27lWfEpw','getTime','32986HyntFp','https://kick.com/api/v1/channels/enjayy','length','username','Live\x20check\x20failed:','KickBot','prize','created_at','timestamp','toString','data','use','messages','hex','Message','Error\x20in\x20pollKickMessages:','/timer','find','update','now','sort','static','findOne','filter','5496OUzlDI','messageCount','686917CexSVm','floor','model','https://kick.com/api/v2/channels/','deleteMany','BotRix','Next\x20roll\x20scheduled\x20for:\x20','status','toLowerCase','error','listen','54kZwAYI','limit','34lKiSzR','1101rhWjhs','120LAkKDH','public','save','max','Schema','winner','getFullYear','pow','findOneAndUpdate'];_0x5eea=function(){return _0x1b9854;};return _0x5eea();}function similarity(_0x4504e9,_0x313031){const _0x2d80e9=_0x263caa,_0x1718d6=new Set(_0x4504e9[_0x2d80e9(0x1d7)]()['split'](/\s+/)),_0x520ab0=new Set(_0x313031[_0x2d80e9(0x1d7)]()[_0x2d80e9(0x208)](/\s+/)),_0x45b601=new Set([..._0x1718d6][_0x2d80e9(0x1cc)](_0x504cc8=>_0x520ab0[_0x2d80e9(0x1f5)](_0x504cc8)));return _0x45b601[_0x2d80e9(0x1f6)]/Math[_0x2d80e9(0x1e1)](_0x1718d6[_0x2d80e9(0x1f6)],_0x520ab0['size']);}app[_0x263caa(0x203)](_0x263caa(0x1b1),async(_0x168153,_0x52c036)=>{const _0x41dcea=_0x263caa,_0x503b95=await Message['find']()[_0x41dcea(0x1c9)]({'messageCount':-0x1})[_0x41dcea(0x1db)](0x64)['lean']();_0x52c036[_0x41dcea(0x1f4)](_0x503b95['map'](_0x3c907e=>({'username':_0x3c907e['username'],'messageCount':_0x3c907e[_0x41dcea(0x1ce)]})));}),app[_0x263caa(0x203)](_0x263caa(0x1e8),async(_0x4d015a,_0x22c045)=>{const _0x46c308=_0x263caa;try{const _0x2395d3=await isStreamerLive();_0x22c045[_0x46c308(0x1f4)]({'isLive':_0x2395d3});}catch(_0x59ce1e){_0x22c045[_0x46c308(0x1d6)](0x1f4)[_0x46c308(0x1f4)]({'error':_0x59ce1e[_0x46c308(0x207)]});}});async function isStreamerLive(){const _0x35a812=_0x263caa;try{const _0x216074=await _0x6d7f19(_0x35a812(0x1b6));if(!_0x216074['ok'])return![];const _0x4eb0b0=await _0x216074['json']();return _0x4eb0b0[_0x35a812(0x1ee)]&&_0x4eb0b0[_0x35a812(0x1ee)][_0x35a812(0x1fa)];}catch(_0x44a1b2){return console[_0x35a812(0x1d8)](_0x35a812(0x1b9),_0x44a1b2[_0x35a812(0x207)]),![];}}async function pollKickMessages(){const _0x5a2081=_0x263caa;try{const _0x60e30d=await isStreamerLive();if(!_0x60e30d){console[_0x5a2081(0x1f1)]('Streamer\x20is\x20offline\x20—\x20skipping\x20message\x20polling.');return;}const _0x414cb5=_0x5a2081(0x1d2)+CHANNEL_ID+'/messages',_0x1da70b=await _0x6d7f19(_0x414cb5,{'headers':{'User-Agent':'Mozilla/5.0'}});if(!_0x1da70b['ok']){console[_0x5a2081(0x1d8)](_0x5a2081(0x1f8),await _0x1da70b[_0x5a2081(0x201)]());return;}const _0x3413f5=await _0x1da70b['json'](),_0x28f596=(_0x3413f5[_0x5a2081(0x1bf)]?.[_0x5a2081(0x1c1)]||[])['sort']((_0x457f53,_0x45252f)=>new Date(_0x457f53[_0x5a2081(0x1bc)])-new Date(_0x45252f[_0x5a2081(0x1bc)]));for(const _0x1cf4a9 of _0x28f596){if(lastSeenMessageId===_0x1cf4a9['id'])break;const _0x251c6c=_0x1cf4a9['sender']?.['username'],_0x4bfde4=_0x1cf4a9[_0x5a2081(0x206)],_0x483b95=new Date(_0x1cf4a9['created_at'])[_0x5a2081(0x1b4)]();if(!_0x251c6c||!_0x4bfde4)continue;if(IGNORED_USERS[_0x5a2081(0x1fb)](_0x251c6c))continue;if(isSpamMessage(_0x251c6c,_0x4bfde4,_0x483b95))continue;await Message[_0x5a2081(0x1e6)]({'username':_0x251c6c},{'$inc':{'messageCount':0x1}},{'upsert':!![]});}_0x28f596[_0x5a2081(0x1b7)]&&(lastSeenMessageId=_0x28f596[_0x28f596[_0x5a2081(0x1b7)]-0x1]['id']);}catch(_0x32a01a){console['error'](_0x5a2081(0x1c4),_0x32a01a[_0x5a2081(0x207)]);}}((async()=>{const _0x3162a2=_0x263caa;try{const _0x1a3798=await _0x6d7f19('https://kick.com/api/v2/channels/'+CHANNEL_ID+_0x3162a2(0x1b2),{'headers':{'User-Agent':'Mozilla/5.0'}}),_0x39a2ca=await _0x1a3798[_0x3162a2(0x1f4)](),_0x36b1e8=_0x39a2ca[_0x3162a2(0x1bf)]?.[_0x3162a2(0x1c1)]||[];_0x36b1e8[_0x3162a2(0x1b7)]&&(lastSeenMessageId=_0x36b1e8[_0x36b1e8[_0x3162a2(0x1b7)]-0x1]['id']);}catch(_0x5941de){}setInterval(pollKickMessages,0x3e8);})()),_0x10ecfb[_0x263caa(0x1b0)](_0x263caa(0x205),async()=>{const _0x1fd99b=getTimeUntilReset();_0x1fd99b===0x0&&(await resetLeaderboard(),await performRoll());}),((async()=>{const _0x3603bc=_0x263caa;nextRollTime=getNextRollTime(),console[_0x3603bc(0x1f1)](_0x3603bc(0x1d5)+nextRollTime);})()),app[_0x263caa(0x1c0)](_0x49de20[_0x263caa(0x1ca)](_0x263caa(0x1df))),app[_0x263caa(0x1d9)](PORT,()=>console[_0x263caa(0x1f1)]('Server\x20on\x20port\x20'+PORT));
